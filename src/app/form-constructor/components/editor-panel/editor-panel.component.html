<div class="editor-panel">
  <!-- Editor Toolbar -->
  <div class="editor-toolbar">
    <div class="toolbar-group">
      <button class="btn btn-sm" (click)="clearCanvas()" title="Clear Canvas">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
        </svg>
      </button>
      
      <div class="toolbar-separator"></div>
      
      <button class="btn btn-sm" (click)="exportForm()" title="Generate Code">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
        </svg>
      </button>
    </div>
    
    <div class="editor-info">
      <span class="text-sm text-gray-500">
        {{ hasComponents() ? components().length + ' components' : 'Drag components here' }}
      </span>
    </div>
  </div>

  <!-- Editor Canvas Container -->
  <div class="editor-container">
    <!-- Editor Canvas -->
    <div
      #editorCanvas
      cdkDropList
      id="main-editor-list"
      [cdkDropListData]="components()"
      [cdkDropListConnectedTo]="['sidebar-list', 'sidebar-layout-list', 'sidebar-actions-list']"
      (cdkDropListDropped)="onDrop($event)"
      (cdkDropListEntered)="onDragEntered($event)"
      (cdkDropListExited)="onDragExited($event)"
      class="editor-canvas"
      [class.has-components]="hasComponents()">
      

      
      <!-- Dropped Components -->
      @for (component of components(); track component.id; let i = $index) {
        <div
          cdkDrag
          [cdkDragData]="component"
          [class.selected]="selectedComponentId() === component.id"
          class="dropped-component"
          (click)="onComponentClick(component, $event)">
          
          <!-- Component Preview -->
          <div class="component-preview">
            @switch (component.type) {
              @case ('text-input') {
                <div class="form-group preview">
                  <label class="form-label">{{ component.properties.label }}</label>
                  <input type="text" 
                         class="form-control" 
                         [placeholder]="component.properties.placeholder"
                         disabled>
                </div>
              }
              @case ('email-input') {
                <div class="form-group preview">
                  <label class="form-label">{{ component.properties.label }}</label>
                  <input type="email" 
                         class="form-control" 
                         [placeholder]="component.properties.placeholder"
                         disabled>
                </div>
              }
              @case ('textarea') {
                <div class="form-group preview">
                  <label class="form-label">{{ component.properties.label }}</label>
                  <textarea class="form-control" 
                            [rows]="component.properties.rows"
                            [placeholder]="component.properties.placeholder"
                            disabled></textarea>
                </div>
              }
              @case ('select') {
                <div class="form-group preview">
                  <label class="form-label">{{ component.properties.label }}</label>
                  <select class="form-control" disabled>
                    <option>Choose option</option>
                    @for (option of component.properties.options; track option) {
                      <option>{{ option }}</option>
                    }
                  </select>
                </div>
              }
              @case ('checkbox') {
                <div class="form-check preview">
                  <input type="checkbox" 
                         class="form-check-input" 
                         [checked]="component.properties.checked"
                         disabled>
                  <label class="form-check-label">{{ component.properties.label }}</label>
                </div>
              }
              @case ('button') {
                <button type="button" 
                        class="btn"
                        [class]="'btn-' + component.properties.variant"
                        disabled>
                  {{ component.properties.text }}
                </button>
              }
              @case ('container') {
                <div
                  cdkDropList
                  [id]="'container-' + component.id"
                  [cdkDropListData]="getFilteredChildren(component)"
                  [cdkDropListConnectedTo]="getContainerConnectedLists(component.id)"
                  (cdkDropListDropped)="onContainerDrop($event, component)"
                  class="form-container preview container-component"
                  [style.display]="component.properties.layout"
                  [style.flex-direction]="component.properties.direction"
                  [style.gap]="component.properties.gap">
                  
                  @if (!component.children?.length) {
                    <p class="container-placeholder">
                      Drop components here
                    </p>
                  }
                  
                  <!-- Nested components -->
                  @for (child of getFilteredChildren(component); track child.id) {
                    <div
                      cdkDrag
                      [cdkDragData]="child"
                      [class.selected]="selectedComponentId() === child.id"
                      class="dropped-component nested-component"
                      (click)="onComponentClick(child, $event)">
                      
                      <div class="component-preview">
                        @switch (child.type) {
                          @case ('text-input') {
                            <div class="form-group preview">
                              <label class="form-label">{{ child.properties.label }}</label>
                              <input type="text" 
                                     class="form-control" 
                                     [placeholder]="child.properties.placeholder"
                                     disabled>
                            </div>
                          }
                          @case ('email-input') {
                            <div class="form-group preview">
                              <label class="form-label">{{ child.properties.label }}</label>
                              <input type="email" 
                                     class="form-control" 
                                     [placeholder]="child.properties.placeholder"
                                     disabled>
                            </div>
                          }
                          @case ('textarea') {
                            <div class="form-group preview">
                              <label class="form-label">{{ child.properties.label }}</label>
                              <textarea class="form-control" 
                                        [rows]="child.properties.rows"
                                        [placeholder]="child.properties.placeholder"
                                        disabled></textarea>
                            </div>
                          }
                          @case ('select') {
                            <div class="form-group preview">
                              <label class="form-label">{{ child.properties.label }}</label>
                              <select class="form-control" disabled>
                                <option>Choose option</option>
                                @for (option of child.properties.options; track option) {
                                  <option>{{ option }}</option>
                                }
                              </select>
                            </div>
                          }
                          @case ('checkbox') {
                            <div class="form-check preview">
                              <input type="checkbox" 
                                     class="form-check-input" 
                                     [checked]="child.properties.checked"
                                     disabled>
                              <label class="form-check-label">{{ child.properties.label }}</label>
                            </div>
                          }
                          @case ('button') {
                            <button type="button" 
                                    class="btn"
                                    [class]="'btn-' + child.properties.variant"
                                    disabled>
                              {{ child.properties.text }}
                            </button>
                          }
                        }
                      </div>
                      <div class="component-controls">
                        <button class="control-btn delete-btn" 
                                (click)="onComponentDelete(child.id, $event)"
                                title="Delete Component">
                          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                          </svg>
                        </button>
                      </div>
                    </div>
                  }
                </div>
              }
            }
          </div>
          <div class="component-controls">
            <button class="control-btn delete-btn" 
                    (click)="onComponentDelete(component.id, $event)"
                    title="Delete Component">
              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
          </div>
        </div>
      }
    </div>
  </div>
</div>
<div class="editor-panel">
  <!-- Editor Toolbar -->
  <app-editor-toolbar
    [componentCount]="components().length"
    (clearCanvas)="clearCanvas()"
    (exportForm)="exportForm()">
  </app-editor-toolbar>

  <!-- Drag Ghost Component (initially hidden) -->
  <app-drag-ghost style="display: none;"></app-drag-ghost>

  <!-- Editor Canvas Container -->
  <div class="editor-container">
    <!-- Visible Form Layer -->
    <div
      #visibleCanvas
      class="editor-canvas visible-layer"
      [class.has-components]="hasComponents()"
      [attr.data-droppable]="'true'"
      [attr.data-layout]="'column'"
      style="position: relative;">

      <!-- Visible Components -->
      @for (component of components(); track component.id; let i = $index) {
        <div
          [class.selected]="selectedComponentId() === component.id"
          class="dropped-component visible-component"
          (click)="onComponentClick(component, $event)"
          [style.width]="component.properties['width'] || '100%'"
          [style.min-width]="'0'"
          [attr.data-component-id]="component.id">

          <!-- Component Preview -->
          <app-form-element
            [component]="component"
            [isSelected]="selectedComponentId() === component.id"
            [selectedComponentId]="selectedComponentId()"
            (click)="onComponentClick(component, $event.event)">
          </app-form-element>

        </div>
      }
      
      @if (components().length === 0) {
        <div style="text-align: center; padding: 40px; color: #666; font-style: italic;">
          ðŸŽ¯ No components yet. Drop something here!
        </div>
      }
    </div>
    
    <!-- Invisible Drag Layer -->
    <div
      #invisibleCanvas
      cdkDropList
      id="main-editor-list"
      [cdkDropListData]="components()"
      [cdkDropListConnectedTo]="['sidebar-list', 'sidebar-layout-list', 'sidebar-actions-list']"
      (cdkDropListDropped)="onDrop($event)"
      [cdkDropListAutoScrollDisabled]="true"
      [attr.data-droppable]="'true'"
      [attr.data-layout]="'column'"
      class="editor-canvas invisible-layer">

      <!-- Invisible Draggable Components -->
      @for (component of components(); track component.id; let i = $index) {
        <div
          cdkDrag
          [cdkDragDisabled]="dragInProgress()"
          [cdkDragData]="component"
          class="dropped-component invisible-component"
          (cdkDragStarted)="onDragStarted($event)"
          (cdkDragMoved)="onDragMoved($event)"
          [style.width]="component.properties['width'] || '100%'"
          [style.min-width]="'0'"
          [style.height]="'auto'"
          [style.min-height]="'auto'"
          [attr.data-component-id]="component.id">
        </div>
      }
    </div>
  </div>
</div>
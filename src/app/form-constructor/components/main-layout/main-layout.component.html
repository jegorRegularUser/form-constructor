<div [ngClass]="layoutClasses()" (window:resize)="onResize()">
  <!-- Header Section -->
  <header class="header">
    <div class="flex items-center justify-between h-full px-4">
      <!-- Left side: Logo and navigation -->
      <div class="flex items-center gap-4">
        <button
          class="btn btn-icon"
          (click)="toggleSidebar()"
          aria-label="Toggle sidebar">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
        
        <div class="flex items-center gap-2">
          <svg class="w-8 h-8 text-primary-600" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
          <h1 class="text-xl font-semibold text-gray-900">Form Constructor</h1>
        </div>
      </div>

      <!-- Center: Project actions -->
      <div class="flex items-center gap-2">
        <button class="btn btn-sm" (click)="newForm()">

          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
          </svg>
          New
        </button>
        <button class="btn btn-sm" (click)="openForm()">

          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"/>
          </svg>
          Open
        </button>
        <button class="btn btn-sm" (click)="saveForm()">

          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"/>
          </svg>
          Save
        </button>
      </div>

      <!-- Right side: Panel switcher for mobile + Actions -->
      <div class="flex items-center gap-2">
        <!-- Mobile Panel Switcher -->
        @if (isMobile() || isTablet()) {
          <div class="panel-switcher">
            <button
              class="btn btn-sm"
              [class.active]="activePanel() === 'editor'"
              (click)="setActivePanel('editor')">
              Editor
            </button>
            <button
              class="btn btn-sm"
              [class.active]="activePanel() === 'preview'"
              (click)="setActivePanel('preview')">
              Preview
            </button>
            <button
              class="btn btn-sm"
              [class.active]="activePanel() === 'code'"
              (click)="setActivePanel('code')">
              Code
            </button>
          </div>
          <div class="toolbar-separator"></div>
        }
        
        <button class="btn btn-sm" (click)="previewForm()" [class.active]="showPreview()">

          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
          </svg>
          @if (!isMobile()) { Preview }
        </button>
        <button class="btn btn-primary btn-sm" (click)="exportForm()">
          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
          @if (!isMobile()) { Export }
        </button>
      </div>
    </div>
  </header>

  <!-- Toolbar/Sidebar Section -->
  <aside class="toolbar custom-scrollbar">
    <div class="component-library">
      <!-- Component Categories with Drag and Drop -->
      <div class="component-category">
        <h3 class="component-category-title">Form Elements</h3>
        <div class="component-grid">
          <div class="component-block"
               draggable="true"
               (dragstart)="onDragStart($event, 'text-input')"
               (dragend)="onDragEnd($event)">
            <svg class="component-block-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
            <span class="component-block-label">Text Input</span>
          </div>
          <div class="component-block"
               draggable="true"
               (dragstart)="onDragStart($event, 'email-input')"
               (dragend)="onDragEnd($event)">
            <svg class="component-block-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"/>
            </svg>
            <span class="component-block-label">Email</span>
          </div>
          <div class="component-block"
               draggable="true"
               (dragstart)="onDragStart($event, 'textarea')"
               (dragend)="onDragEnd($event)">
            <svg class="component-block-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707L13.293 3.293A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
            </svg>
            <span class="component-block-label">Textarea</span>
          </div>
          <div class="component-block"
               draggable="true"
               (dragstart)="onDragStart($event, 'select')"
               (dragend)="onDragEnd($event)">
            <svg class="component-block-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4"/>
            </svg>
            <span class="component-block-label">Select</span>
          </div>
          <div class="component-block"
               draggable="true"
               (dragstart)="onDragStart($event, 'checkbox')"
               (dragend)="onDragEnd($event)">
            <svg class="component-block-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span class="component-block-label">Checkbox</span>
          </div>
        </div>
      </div>

      <div class="component-category">
        <h3 class="component-category-title">Layout</h3>
        <div class="component-grid">
          <div class="component-block"
               draggable="true"
               (dragstart)="onDragStart($event, 'container')"
               (dragend)="onDragEnd($event)">
            <svg class="component-block-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
            </svg>
            <span class="component-block-label">Container</span>
          </div>
        </div>
      </div>

      <div class="component-category">
        <h3 class="component-category-title">Actions</h3>
        <div class="component-grid">
          <div class="component-block"
               draggable="true"
               (dragstart)="onDragStart($event, 'button')"
               (dragend)="onDragEnd($event)">
            <svg class="component-block-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
            </svg>
            <span class="component-block-label">Button</span>
          </div>
        </div>
      </div>
    </div>
  </aside>

  <!-- Editor Section -->
  @if (showEditor()) {
    <main class="editor">
      <div class="editor-container" (dragover)="onDragOver($event)">
        <app-editor-panel></app-editor-panel>
      </div>
    </main>
  }

  <!-- Preview Section -->
  @if (showPreview()) {
    <section class="preview">
      <div class="preview-container">
        <app-preview-panel></app-preview-panel>
      </div>
    </section>
  }

  <!-- Code Panel -->
  @if (showCode()) {
    <section class="code-panel">
      <div class="code-tabs">
        <button class="code-tab active">TypeScript</button>
        <button class="code-tab">HTML</button>
        <button class="code-tab">CSS</button>
      </div>
      <div class="code-content">
        <pre><code>// Generated Angular component code will appear here
// Select components in the editor to generate code</code></pre>
      </div>
    </section>
  }

  <!-- Properties Panel -->
  @if (showProperties()) {
    <aside class="properties">
      <app-property-panel></app-property-panel>
    </aside>
  }
</div>
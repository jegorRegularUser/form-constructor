<div
  class="editor"
  (mousemove)="onMouseMove($event)"
  (mouseleave)="onMouseLeave()"
  (mouseup)="onDrop()"
  (click)="onEditorClick($event)"
>
  <div class="editor-content" [ngStyle]="formStyles">
    <div
      *ngFor="let row of elements; let rowIndex = index"
      class="element-row"
      [attr.data-row-index]="rowIndex"
    >
      <!-- Universal rendering of elements -->
      <ng-container *ngFor="let element of row; let colIndex = index">
        <!-- Input component -->
        <lib-input
          *ngIf="element.type === 'input'"
          #inputElement
          [value]="element.value"
          [id]="element.id"
          [isDragged]="isElementDragged(element.id)"
          [isSelected]="isElementSelected(element.id)"
          [properties]="getElementProperties(element.id)"
          [placeholder]="element.placeholder || 'Enter text...'"
          (dragHandleMouseDown)="
            onExistingElementDragStart($event, element.id, rowIndex, colIndex)
          "
          (elementClick)="onElementClick(element.id, $event)"
          (deleteElement)="onDeleteElement($event)"
          (duplicateElement)="onDuplicateElement($event)"
          (toggleRequired)="onToggleRequired($event)"
          (openSettings)="onOpenElementSettings($event)"
          (labelEditEnd)="onLabelEdit(element.id, $event)"
        ></lib-input>
        
        <!-- Textarea component -->
        <lib-textarea
          *ngIf="element.type === 'textarea'"
          #textareaElement
          [value]="element.value"
          [id]="element.id"
          [rows]="element.rows || 3"
          [placeholder]="element.placeholder || 'Enter text here...'"
          [isDragged]="isElementDragged(element.id)"
          [isSelected]="isElementSelected(element.id)"
          [properties]="getElementProperties(element.id)"
          (dragHandleMouseDown)="
            onExistingElementDragStart($event, element.id, rowIndex, colIndex)
          "
          (elementClick)="onElementClick(element.id, $event)"
          (deleteElement)="onDeleteElement($event)"
          (duplicateElement)="onDuplicateElement($event)"
          (toggleRequired)="onToggleRequired($event)"
          (openSettings)="onOpenElementSettings($event)"
          (labelEditEnd)="onLabelEdit(element.id, $event)"
        ></lib-textarea>
        
        <!-- Select component -->
        <lib-select-element
          *ngIf="element.type === 'select'"
          #selectElement
          [id]="element.id"
          [isDragged]="isElementDragged(element.id)"
          [isSelected]="isElementSelected(element.id)"
          [properties]="getElementProperties(element.id)"
          (dragHandleMouseDown)="
            onExistingElementDragStart($event, element.id, rowIndex, colIndex)
          "
          (elementClick)="onElementClick(element.id, $event)"
          (deleteElement)="onDeleteElement($event)"
          (duplicateElement)="onDuplicateElement($event)"
          (toggleRequired)="onToggleRequired($event)"
          (openSettings)="onOpenElementSettings($event)"
          (labelEditEnd)="onLabelEdit(element.id, $event)"
        ></lib-select-element>
        
        <!-- Button component -->
        <lib-button-element
          *ngIf="element.type === 'button'"
          #buttonElement
          [id]="element.id"
          [isDragged]="isElementDragged(element.id)"
          [isSelected]="isElementSelected(element.id)"
          [properties]="getElementProperties(element.id)"
          (dragHandleMouseDown)="
            onExistingElementDragStart($event, element.id, rowIndex, colIndex)
          "
          (elementClick)="onElementClick(element.id, $event)"
          (deleteElement)="onDeleteElement($event)"
          (duplicateElement)="onDuplicateElement($event)"
          (openSettings)="onOpenElementSettings($event)"
          (labelEditEnd)="onLabelEdit(element.id, $event)"
        ></lib-button-element>
      </ng-container>
    </div>

    <div *ngIf="elements.length === 0 || (elements.length === 1 && elements[0].length === 0)" class="empty-state">
      Drag components here to start building
    </div>
  </div>

  <!-- Drop indicator bar -->
  <div
    *ngIf="showDropIndicator"
    class="drop-indicator"
    [class.horizontal]="indicatorOrientation === 'horizontal'"
    [class.vertical]="indicatorOrientation === 'vertical'"
    [style.left]="dropIndicatorLeft + 'px'"
    [style.top]="dropIndicatorTop + 'px'"
    [style.width]="dropIndicatorWidth + 'px'"
    [style.height]="dropIndicatorHeight + 'px'"
  ></div>
</div>